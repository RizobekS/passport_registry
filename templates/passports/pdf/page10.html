{% extends "passports/pdf/base.html" %}
{% load pdf_utils %} {# dmy, dash #}

{% block extra_css %}
<style>
  .labs10 {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
    margin-top: 3mm;
    font-size: 10.5pt;
    line-height: 1.25;
  }
  .labs10 th, .labs10 td {
    border: 0.6pt solid #333;
    vertical-align: top;
    padding: 2mm;
  }

  /* Пропорции колонок как у бланка */
  .c-date   { width: 12%; }
  .c-type   { width: 20%; }
  .c-dis    { width: 20%; }
  .c-res    { width: 24%; }
  .c-lab    { width: 24%; }

  .title { text-align:center; margin: 0 0 2mm 0; }
  .tri   { display:block; text-align:center; }
  .row-fill { height: 14mm; }
  .lined {
    min-height: 12mm;
    background-image: linear-gradient(to bottom, transparent 92%, #bbb 92%, #bbb 94%, transparent 94%);
    background-size: 100% 6mm;
    padding: 1mm 1.25mm;
  }
</style>
{% endblock %}

{% block content %}
  <h3 class="title">
    Лаборатория текширишлари ўтказилганлиги тўғрисида маълумот<br>
    Данные о проведении лабораторных исследований<br>
    <span class="muted">Laboratory health test</span>
  </h3>

  <table class="labs10">
    <colgroup>
      <col class="c-date">
      <col class="c-type">
      <col class="c-dis">
      <col class="c-res">
      <col class="c-lab">
    </colgroup>

    <thead>
      <tr>
        <th>
          <span class="tri">Сана</span>
          <span class="tri">Дата</span>
          <span class="tri"><strong>Date</strong></span>
        </th>
        <th>
          <span class="tri">Текшириш тури</span>
          <span class="tri">Вид исследования</span>
          <span class="tri"><strong>Type of test</strong></span>
        </th>
        <th>
          <span class="tri">Касаллик номи</span>
          <span class="tri">Название болезни</span>
          <span class="tri"><strong>Name of disease</strong></span>
        </th>
        <th>
          <span class="tri">Текшириш натижалари</span>
          <span class="tri">Результат исследования</span>
          <span class="tri"><strong>Result of the tests</strong></span>
        </th>
        <th>
          <span class="tri">Лабораториянинг номи, манзили ва муҳр</span>
          <span class="tri">Наименование, адрес лаборатории и печать</span>
          <span class="tri"><strong>Name and Address of the laboratory and Company Stamp</strong></span>
        </th>
      </tr>
    </thead>

    <tbody>
      {# реальные записи из БД; если каких-то полей нет — оставляем пусто #}
      {% for t in horse.lab_tests.all|dictsort:"date" %}
        <tr>
          <td>{{ t.date|dmy|dash }}</td>
          <td>{% if t.test_type %}{{ t.test_type.name }}{% else %}—{% endif %}</td>
          <td>
            {# у нас нет отдельного поля «болезнь» — оставляем пустым либо дублируем часть результата при желании #}
          </td>
          <td>{{ t.result|dash }}</td>
          <td>
            {# если лаборатория хранится через ветеринара — выведем его ФИО/лицензию; адреса как такового нет в модели #}
            {% if t.veterinarian %}
              {% with p=t.veterinarian.person %}
                {% if p %}{{ p.last_name }} {{ p.first_name }} {{ p.middle_name }}{% endif %}
              {% endwith %}
              {% if t.veterinarian.license_no %}<br>Лицензия: {{ t.veterinarian.license_no }}{% endif %}
            {% endif %}
          </td>
        </tr>
      {% endfor %}

      {# 4 пустые строки для ручного внесения #}
      <tr class="row-fill">
        <td class="lined"></td><td class="lined"></td><td class="lined"></td><td class="lined"></td><td class="lined"></td>
      </tr>
      <tr class="row-fill">
        <td class="lined"></td><td class="lined"></td><td class="lined"></td><td class="lined"></td><td class="lined"></td>
      </tr>
      <tr class="row-fill">
        <td class="lined"></td><td class="lined"></td><td class="lined"></td><td class="lined"></td><td class="lined"></td>
      </tr>
      <tr class="row-fill">
        <td class="lined"></td><td class="lined"></td><td class="lined"></td><td class="lined"></td><td class="lined"></td>
      </tr>
    </tbody>
  </table>
{% endblock %}
