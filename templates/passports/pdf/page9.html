{% extends "passports/pdf/base.html" %}
{% load pdf_utils %} {# dmy, dash #}

{% block extra_css %}
<style>
  .labs-table{
    width:100%;
    border-collapse:collapse;
    table-layout:fixed;
    margin-top:3mm;
    font-size:10.5pt;
    line-height:1.25;
  }
  .labs-table th,.labs-table td{
    border:0.6pt solid #333;
    vertical-align:top;
    padding:2mm;
  }
  /* ширины колонок */
  .c-test    { width: 30%; }
  .c-date    { width: 20%; }
  .c-result  { width: 28%; }
  .c-vet     { width: 22%; }

  .tri{ display:block; text-align:center; }
  .title{ text-align:center; margin:0 0 2mm 0; }
  .row-fill{ height:14mm; }
  .lined{
    min-height:12mm;
    background-image:linear-gradient(to bottom, transparent 92%, #bbb 92%, #bbb 94%, transparent 94%);
    background-size:100% 6mm;
    padding:1mm 1.25mm;
  }
</style>
{% endblock %}

{% block content %}
  <h3 class="title">
    Лаборатор текширувлар (диагностика) қайдлари<br>
    Записи о лабораторных/диагностических исследованиях<br>
    <span class="muted">Laboratory / diagnostic tests record</span>
  </h3>

  <table class="labs-table">
    <colgroup>
      <col class="c-test">
      <col class="c-date">
      <col class="c-result">
      <col class="c-vet">
    </colgroup>

    <thead>
      <tr>
        <th>
          <span class="tri">Тест номи</span>
          <span class="tri">Наименование теста</span>
          <span class="tri"><strong>Name of test</strong></span>
        </th>
        <th>
          <span class="tri">Текширув санаси, ҳужжат №</span>
          <span class="tri">Дата исследования, № документа</span>
          <span class="tri"><strong>Date of test, document No.</strong></span>
        </th>
        <th>
          <span class="tri">Текширув натижаси</span>
          <span class="tri">Результат исследования</span>
          <span class="tri"><strong>Result of the test</strong></span>
        </th>
        <th>
          <span class="tri">Ветеринар Ф.И.Ш., имзо, муҳр</span>
          <span class="tri">Ф.И.О. ветврача, подпись, печать</span>
          <span class="tri"><strong>Name, signature and stamp of official veterinarian</strong></span>
        </th>
      </tr>
    </thead>

    <tbody>
      {# реальные записи из БД #}
      {% for t in horse.lab_tests.all|dictsort:"date" %}
        <tr>
          <td>{% if t.test_type %}{{ t.test_type.name }}{% else %}—{% endif %}</td>
          <td>
            {{ t.date|dmy|dash }}
            {% if t.document and t.document.name %}<br>№: {{ t.document.name|slice:"-32:" }}{% endif %}
            {# при желании сюда можно вынести номер/рег. из отдельного поля #}
          </td>
          <td>{{ t.result|dash }}</td>
          <td>
            {% if t.veterinarian %}
              {% with p=t.veterinarian.person %}
                {% if p %}{{ p.last_name }} {{ p.first_name }} {{ p.middle_name }}{% endif %}
              {% endwith %}
              {% if t.veterinarian.license_no %}<br>Лицензия: {{ t.veterinarian.license_no }}{% endif %}
            {% else %}—{% endif %}
          </td>
        </tr>
      {% endfor %}

      {# несколько пустых строк для рукописного внесения #}
      <tr class="row-fill"><td class="lined"></td><td class="lined"></td><td class="lined"></td><td class="lined"></td></tr>
      <tr class="row-fill"><td class="lined"></td><td class="lined"></td><td class="lined"></td><td class="lined"></td></tr>
      <tr class="row-fill"><td class="lined"></td><td class="lined"></td><td class="lined"></td><td class="lined"></td></tr>
      <tr class="row-fill"><td class="lined"></td><td class="lined"></td><td class="lined"></td><td class="lined"></td></tr>
      <tr class="row-fill"><td class="lined"></td><td class="lined"></td><td class="lined"></td><td class="lined"></td></tr>
    </tbody>
  </table>
{% endblock %}
