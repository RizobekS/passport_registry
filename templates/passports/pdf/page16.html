{% extends "passports/pdf/base.html" %}
{% load pdf_utils %} {# dmy, dash, static_file #}

{% block extra_css %}
<style>
  .title { text-align:center; margin:0 0 2mm 0; }
  .tri { display:block; text-align:center; }

  .ownchg { width:100%; border-collapse:collapse; table-layout:fixed; margin-top:3mm; }
  .ownchg th, .ownchg td { border:0.6pt solid #333; vertical-align:top; padding:2mm; line-height:1.25; font-size:10.5pt; }
  .c-date { width:18%; } .c-owner { width:52%; } .c-sign { width:30%; }

  .row-fill { height:12mm; }
  .lined {
    min-height:10mm;
    background-image:linear-gradient(to bottom, transparent 92%, #bbb 92%, #bbb 94%, transparent 94%);
    background-size:100% 6mm; padding:1mm 1.25mm;
  }

  .parentage { margin-top:10mm; }
  .pgrid { width:100%; border-collapse:collapse; table-layout:fixed; }
  .pgrid td { border-bottom:0.6pt solid #333; padding:1.6mm 0; vertical-align:bottom; font-size:10.5pt; }
  .lab { width:28%; color:#333; }
  .val { width:72%; padding-left:2mm; }
  .thin { border-bottom:0.4pt solid #999; }

  .two-col { display:grid; grid-template-columns: 1fr 1fr; column-gap:8mm; }
</style>
{% endblock %}

{% block content %}
  <h3 class="title">
    От эгасининг ўзгарганлиги тўғрисида маълумот<br>
    Сведения о смене владельца<br>
    <span class="muted">Information on change of the ownership</span>
  </h3>

  <table class="ownchg">
    <colgroup><col class="c-date"><col class="c-owner"><col class="c-sign"></colgroup>
    <thead>
      <tr>
        <th>
          <span class="tri">Сотилган санаси</span>
          <span class="tri">Дата продажи</span>
          <span class="tri"><strong>Date of sale</strong></span>
        </th>
        <th>
          <span class="tri">От эгасининг Ф.И.Ш. ва манзили</span>
          <span class="tri">Ф.И.О., владельца и адрес</span>
          <span class="tri"><strong>Name, address of the owner</strong></span>
        </th>
        <th>
          <span class="tri">Ўзбекистон ёки/ичкингина ва от спорти федерацияси ваколатли</span>
          <span class="tri">Подпись и место печати</span>
          <span class="tri"><strong>Signature and Company Stamp</strong></span>
        </th>
      </tr>
    </thead>
    <tbody>
      {# текущий владелец как последняя запись владения (если есть) #}
      {% with cur=horse.owner_current %}
      <tr class="row-fill">
        <td class="lined">
          {% with last=horse.ownerships.all|first %}{% if last %}{{ last.start_date|dmy }}{% endif %}{% endwith %}
        </td>
        <td class="lined">
          {% if cur %}
            {% if cur.person %}
              {{ cur.person.last_name }} {{ cur.person.first_name }} {{ cur.person.middle_name }}{% if cur.person.address %}, {{ cur.person.address }}{% endif %}
            {% elif cur.organization %}
              {{ cur.organization.name }}{% if cur.organization.address %}, {{ cur.organization.address }}{% endif %}
            {% endif %}
          {% endif %}
        </td>
        <td class="lined"></td>
      </tr>
      {% endwith %}

      {# +3 пустых строки для ручной записи будущих смен владельца #}
      <tr class="row-fill"><td class="lined"></td><td class="lined"></td><td class="lined"></td></tr>
      <tr class="row-fill"><td class="lined"></td><td class="lined"></td><td class="lined"></td></tr>
      <tr class="row-fill"><td class="lined"></td><td class="lined"></td><td class="lined"></td></tr>
    </tbody>
  </table>

  <!-- Блок Parentage (текстовый), как на макете под таблицей -->
  <div class="parentage">
    <div class="two-col">
      <table class="pgrid">
        <tbody>
          <tr><td class="lab">Туғилган жойи / Place of birth</td><td class="val thin">{{ horse.place_of_birth|dash }}</td></tr>
          <tr><td class="lab">Кличка / Name</td><td class="val thin">{{ horse.name|dash }}</td></tr>
          <tr><td class="lab">Тавро / Brand</td><td class="val thin">{{ horse.brand_mark|dash }}</td></tr>
          <tr><td class="lab">Зоти / Breed</td><td class="val thin">{{ horse.breed|dash }}</td></tr>
          <tr><td class="lab">Жинси / Sex</td><td class="val thin">{{ horse.get_sex_display|dash }}</td></tr>
        </tbody>
      </table>

      <table class="pgrid">
        <tbody>
          <tr><td class="lab">Туси / Colour</td><td class="val thin">{{ horse.color|dash }}</td></tr>
          <tr><td class="lab">ДНК №</td><td class="val thin">—</td></tr>
          <tr><td class="lab">ПИНК №</td><td class="val thin">—</td></tr>
          <tr><td class="lab">SNB №</td><td class="val thin">—</td></tr>
          <tr><td class="lab">Туғилган санаси / Date of birth</td><td class="val thin">{{ horse.birth_date|dmy|dash }}</td></tr>
        </tbody>
      </table>
    </div>

    <table class="pgrid" style="margin-top:4mm;">
      <tbody>
        <tr><td class="lab">Иммунитет экспертизаси рақами, санаси / Immunity expertise №, date</td><td class="val thin">—</td></tr>
      </tbody>
    </table>
  </div>
{% endblock %}
