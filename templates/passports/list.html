{% extends layout_path %}
{% load widget_tweaks %}
{% load static %}

{% block title %}Список паспортов{% endblock title %}
{% block vendor_css %}

{% endblock vendor_css %}
{% block content %}
<div class="container-xxl flex-grow-1 container-p-y">
  <form method="get" class="card mb-4 p-3">
  <div class="row g-3">
    <div class="col-md-4">
      <label class="form-label">{{ filter.form.status.label }}</label>
      {{ filter.form.status|add_class:"form-select" }}
    </div>
    <div class="col-md-4">
      <label class="form-label">{{ filter.form.breed.label }}</label>
      {{ filter.form.breed|add_class:"form-select" }}
    </div>
    <div class="col-md-4">
      <label class="form-label">{{ filter.form.region.label }}</label>
      {{ filter.form.region|add_class:"form-select" }}
    </div>
    <div class="col-md-4">
      <label class="form-label">{{ filter.form.owner_kind.label }}</label>
      {{ filter.form.owner_kind|add_class:"form-select" }}
    </div>
    <div class="col-md-4">
      <label class="form-label">{{ filter.form.year.label }}</label>
      {{ filter.form.year|add_class:"form-control" }}
    </div>
    <div class="col-md-4">
      <label class="form-label">{{ filter.form.microchip.label }}</label>
      {{ filter.form.microchip|add_class:"form-control" }}
    </div>
  </div>
  <div class="mt-3 d-flex gap-2">
    <button class="btn btn-primary"><i class="ti ti-filter me-1"></i> Фильтр</button>
    <a href="?" class="btn btn-outline-secondary"><i class="ti ti-refresh me-1"></i> Сброс</a>
  </div>
</form>

  <div class="card">
    <div class="table-responsive text-nowrap">
      <table class="table">
        <thead>
          <tr>
            <th>№ паспорта</th>
            <th>Кличка лошади</th>
            <th>Порода</th>
            <th>Регион</th>
            <th>Статус</th>
            <th>Владелец</th>
            <th>Дата выдачи</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
        {% for p in items %}
        <tr>
          <td>{{ p.number }}</td>
          <td>{{ p.horse.name }}</td>
          <td class="text-wrap">{{ p.horse.breed.name }}</td>
          <td>{{ p.horse.place_of_birth.name }}</td>
          <td><span class="badge bg-label-{% if p.status == 'ISSUED' or p.status == 'REISSUED' %}success {% elif p.status == 'DRAFT' %}warning {% else %}danger {% endif %}">{{ p.get_status_display }}</span></td>
          <td>{{ p.horse.owner_current }}</td>
          <td>{{ p.issue_date|date:'d.m.Y' }}</td>
          <td class="text-end">
            <a class="btn btn-sm btn-outline-primary" href="{% url 'passports:public' p.qr_public_id %}" target="_blank">Открыть</a>
            {% if p.pdf_file %}
            <a class="btn btn-sm btn-outline-secondary" href="{{ p.pdf_file.url }}" target="_blank">PDF</a>
            {% else %}
            <a class="btn btn-sm btn-outline-secondary text-muted" href="#!">—</a>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="7" class="text-center">Ничего не найдено</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="card-footer">
      {% if is_paginated %}
      <nav>
        <ul class="pagination">
          {% if page_obj.has_previous %}
          <li class="page-item"><a class="page-link" href="?{% if request.GET %}{{ request.GET.urlencode|cut:'page='|cut:'&&' }}&{% endif %}page={{ page_obj.previous_page_number }}">«</a></li>
          {% endif %}
          <li class="page-item active">
            <span class="pagelink">
            {{ page_obj.number }}/{{ paginator.num_pages }}
            </span>
          </li>
          {% if page_obj.has_next %}
          <li class="page-item"><a class="page-link" href="?{% if request.GET %}{{ request.GET.urlencode|cut:'page='|cut:'&&' }}&{% endif %}page={{ page_obj.next_page_number }}">»</a></li>
          {% endif %}
        </ul>
      </nav>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

